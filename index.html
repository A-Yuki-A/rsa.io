<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <title>PrimeGuard RSA – 体験ツール</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <!-- ヘッダー -->
    <header class="header">
        <h1>PrimeGuard RSA – 体験ツール</h1>
        <p>2つの素数 p, q から RSA 鍵を作り、A〜Z・0〜9（最大5文字）を暗号化・復号できます。</p>
    </header>

    <main class="container">
        <!-- 役割選択 -->
        <section class="section">
            <h2>役割を選択</h2>

            <!-- ★ ここを追加 ★ -->
            <div class="rsa-note">
                <p class="rsa-note-title">このツールで使う RSA の前提</p>
                <ol>
                    <li>暗号化する側に渡されるのは公開鍵 <code>n, e</code> のみ。</li>
                    <li><code>p, q, e</code> の 3 つの数が分かると、暗号文を復号できる。</li>
                    <li><code>n = p × q</code> ただし <code>p, q</code> は素数。</li>
                </ol>
                <p class="rsa-note-sub">
                    <strong>e の求め方：</strong>
                    まず <code>φ(n) = (p - 1)(q - 1)</code> を計算し、
                    <code>1 &lt; e &lt; φ(n)</code> の範囲で <code>φ(n)</code> と互いに素な整数を選びます。
                    このツールでは、<code>5001〜5999</code> の中から自動的にそのような e を探しています。
                </p>
            </div>
            <!-- ★ 追加ここまで ★ -->

            <div class="role-select">
                <label class="role-option">
                    <input type="radio" name="role" value="receiver" checked>
                    受信者（鍵を作る側）
                </label>
                <label class="role-option">
                    <input type="radio" name="role" value="sender">
                    送信者（公開鍵で暗号化）
                </label>
                <label class="role-option">
                    <input type="radio" name="role" value="solo">
                    一人で練習
                </label>
            </div>
        </section>

        <!-- 受信者モード -->
        <section class="section" id="receiver-section">
            <h2>受信者モード</h2>
            <h3>1. 鍵生成</h3>
            <p>素数 p, q を選んで公開鍵 (n, e) と秘密鍵 d を作ります。</p>

            <div class="grid-3">
                <div class="form-group">
                    <label for="recv-p">素数 p</label>
                    <select id="recv-p"></select>
                </div>
                <div class="form-group">
                    <label for="recv-q">素数 q</label>
                    <select id="recv-q"></select>
                </div>
                <div class="form-group">
                    <label>公開鍵 e（自動計算）</label>
                    <div id="recv-e-display" class="inline-code">未計算</div>
                </div>
            </div>

            <button id="recv-generate-btn">鍵生成</button>
            <div id="recv-generate-msg"></div>

            <div id="recv-keys" class="key-list" style="display:none;">
                <div class="key-row">
                    <span class="key-label">公開鍵 n</span>
                    <span class="key-value" id="recv-n"></span>
                    <button class="copy-btn" data-copy-target="recv-n">コピー</button>
                </div>
                <div class="key-row">
                    <span class="key-label">公開鍵 e</span>
                    <span class="key-value" id="recv-e"></span>
                    <button class="copy-btn" data-copy-target="recv-e">コピー</button>
                </div>
                <div class="key-row">
                    <span class="key-label">秘密鍵 d</span>
                    <span class="key-value" id="recv-d"></span>
                    <button class="copy-btn" data-copy-target="recv-d">コピー</button>
                </div>
            </div>

            <hr />

            <h3>2. 復号</h3>
            <p>送られてきた暗号文（Base64）を秘密鍵 (n, d) で復号します。</p>

            <div class="grid-3">
                <div class="form-group">
                    <label for="dec-n">公開鍵 n</label>
                    <input type="text" id="dec-n" placeholder="n を貼り付け">
                </div>
                <div class="form-group">
                    <label for="dec-d">秘密鍵 d</label>
                    <input type="text" id="dec-d" placeholder="d を貼り付け">
                </div>
                <div class="form-group">
                    <label for="dec-c">暗号文 (Base64)</label>
                    <textarea id="dec-c" placeholder="暗号文を貼り付け"></textarea>
                </div>
            </div>

            <button id="dec-btn">復号</button>
            <div id="dec-msg"></div>
        </section>

        <!-- 送信者モード -->
        <section class="section" id="sender-section" style="display:none;">
            <h2>送信者モード</h2>
            <p>受信者から渡された公開鍵 (n, e) と平文から暗号文（Base64）を作成します。</p>

            <h3>1. 公開鍵と平文の入力</h3>
            <div class="grid-3">
                <div class="form-group">
                    <label for="sender-enc-n">公開鍵 n</label>
                    <input type="text" id="sender-enc-n" placeholder="受信者から渡された n">
                </div>
                <div class="form-group">
                    <label for="sender-enc-e">公開鍵 e</label>
                    <input type="text" id="sender-enc-e" placeholder="受信者から渡された e">
                </div>
                <div class="form-group">
                    <label for="sender-plain">平文 (A〜Z, 0〜9 / 最大5文字)</label>
                    <input type="text" id="sender-plain" maxlength="5" placeholder="例: HELLO">
                </div>
            </div>

            <button id="sender-enc-btn">暗号化</button>
            <div id="sender-enc-output"></div>
        </section>

        <!-- 一人で行うモード -->
        <section class="section" id="solo-section" style="display:none;">
            <h2>一人で練習モード</h2>
            <p>自分で鍵を作り、その鍵で暗号化・復号の流れを通して確認できます。</p>

            <h3>1. 鍵生成</h3>
            <div class="grid-3">
                <div class="form-group">
                    <label for="solo-p">素数 p</label>
                    <select id="solo-p"></select>
                </div>
                <div class="form-group">
                    <label for="solo-q">素数 q</label>
                    <select id="solo-q"></select>
                </div>
                <div class="form-group">
                    <label>公開鍵 e（自動計算）</label>
                    <div id="solo-e-display" class="inline-code">未計算</div>
                </div>
            </div>

            <button id="solo-generate-btn">鍵生成</button>
            <div id="solo-generate-msg"></div>

            <div id="solo-keys" class="key-list" style="display:none;">
                <div class="key-row">
                    <span class="key-label">公開鍵 n</span>
                    <span class="key-value" id="solo-n"></span>
                    <button class="copy-btn" data-copy-target="solo-n">コピー</button>
                </div>
                <div class="key-row">
                    <span class="key-label">公開鍵 e</span>
                    <span class="key-value" id="solo-e"></span>
                    <button class="copy-btn" data-copy-target="solo-e">コピー</button>
                </div>
                <div class="key-row">
                    <span class="key-label">秘密鍵 d</span>
                    <span class="key-value" id="solo-d"></span>
                    <button class="copy-btn" data-copy-target="solo-d">コピー</button>
                </div>
            </div>

            <hr />

            <h3>2. 暗号化</h3>
            <div class="grid-3">
                <div class="form-group">
                    <label for="solo-enc-n">公開鍵 n</label>
                    <input type="text" id="solo-enc-n" placeholder="上で作った n が自動入力されます">
                </div>
                <div class="form-group">
                    <label for="solo-enc-e">公開鍵 e</label>
                    <input type="text" id="solo-enc-e" placeholder="上で作った e が自動入力されます">
                </div>
                <div class="form-group">
                    <label for="solo-plain">平文 (A〜Z, 0〜9 / 最大5文字)</label>
                    <input type="text" id="solo-plain" maxlength="5" placeholder="例: HELLO">
                </div>
            </div>

            <button id="solo-enc-btn">暗号化</button>
            <div id="solo-enc-output"></div>

            <hr />

            <h3>3. 復号</h3>
            <div class="grid-3">
                <div class="form-group">
                    <label for="solo-dec-n">公開鍵 n</label>
                    <input type="text" id="solo-dec-n" placeholder="上で作った n が自動入力されます">
                </div>
                <div class="form-group">
                    <label for="solo-dec-d">秘密鍵 d</label>
                    <input type="text" id="solo-dec-d" placeholder="上で作った d が自動入力されます">
                </div>
                <div class="form-group">
                    <label for="solo-dec-c">暗号文 (Base64)</label>
                    <textarea id="solo-dec-c" placeholder="暗号文が自動で入ります"></textarea>
                </div>
            </div>

            <button id="solo-dec-btn">復号</button>
            <div id="solo-dec-msg"></div>
        </section>

        <footer class="footer">
            PrimeGuard RSA / RSA 学習用デモ
        </footer>
    </main>

    <!-- 以下、JavaScript 部分は前回と同じ（省略せずそのまま使ってOK） -->
    <!-- …（ここは前回渡した script のままコピペで動きます）… -->
</body>
</html>
